<!DOCTYPE html>
<html lang="vi" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CỔNG THÔNG TIN TÀI NGUYÊN TRỰC TUYẾN HAN AI LAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- CẤU HÌNH GIAO DIỆN --- */
        :root {
            --color-text-dark: #1e293b;
            --color-text-medium: #475569;
            --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            background: var(--bg-gradient);
            color: var(--color-text-dark);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* --- [MỚI] LOADING OVERLAY (BẢO MẬT) --- */
        #loadingOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; z-index: 9999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid #f3f3f3; border-top: 5px solid #3498db;
            border-radius: 50%; animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- LOGO WATERMARK --- */
        .watermark-logo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            max-width: 80vw;
            height: auto;
            background-image: url('https://res.cloudinary.com/dylnm79id/image/upload/v1769343424/Kho%CC%82ng_ne%CC%82%CC%80n_ev0wrm.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.08;
            z-index: 0;
            pointer-events: none;
            filter: grayscale(20%);
        }

        /* --- GLASSMORPHISM MODERN --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            position: relative;
            z-index: 10;
        }

        .hover-card-effect {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        .hover-card-effect:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        /* Modal Styles */
        #linkModal {
            backdrop-filter: blur(8px);
        }
        .modal-content {
            animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modalPop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Nav Sticky */
        .sticky-nav {
            position: sticky;
            top: 1rem;
            z-index: 50;
            margin: 0 auto;
            max-width: fit-content;
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        /* Hide scrollbar for nav */
        .sticky-nav::-webkit-scrollbar { display: none; }
        .sticky-nav { -ms-overflow-style: none; scrollbar-width: none; }

        .nav-item {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
            text-decoration: none;
        }
        .nav-item:hover, .nav-item.active {
            background: white;
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* Button & Input */
        .btn-modern {
            background: linear-gradient(135deg, #FF8C00 0%, #ff7b00 100%);
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }
        .btn-modern:hover {
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
            transform: translateY(-2px);
        }
        
        .input-modern {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(203, 213, 225, 0.8);
            transition: all 0.3s ease;
        }
        .input-modern:focus {
            background: rgba(255, 255, 255, 0.9);
            border-color: #FF8C00;
            box-shadow: 0 0 0 4px rgba(255, 140, 0, 0.1);
        }

        /* Animation */
        .fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none !important; }
        
        /* HSK Colors - Gradients */
        .hsk-1 { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .hsk-2 { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); }
        .hsk-3 { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .hsk-4 { background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); }
        .hsk-5 { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .hsk-6 { background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%); }

        .text-hsk-1 { color: #059669; }
        .text-hsk-2 { color: #0284c7; }
        .text-hsk-3 { color: #7c3aed; }
        .text-hsk-4 { color: #e11d48; }
        .text-hsk-5 { color: #d97706; }
        .text-hsk-6 { color: #991b1b; }

    </style>
</head>
<body>

    <!-- [MỚI] MÀN HÌNH CHỜ (LOADING SCREEN) -->
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <p class="text-gray-500 font-medium animate-pulse">Đang xác thực bảo mật...</p>
    </div>

    <!-- LOGO CHÌM -->
    <div class="watermark-logo"></div>

    <!-- MODAL POPUP (Ẩn mặc định) -->
    <div id="linkModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/40 p-4" onclick="closeModal(event)">
        <div class="modal-content glass-card w-full max-w-lg rounded-2xl p-0 overflow-hidden shadow-2xl relative bg-white" onclick="event.stopPropagation()">
            <!-- Header Modal -->
            <div id="modalHeader" class="p-6 bg-gradient-to-r from-gray-100 to-gray-50 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Tiêu đề</h3>
                    <button onclick="closeModalDirect()" class="text-gray-400 hover:text-gray-600 focus:outline-none transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <p id="modalSubtitle" class="text-sm text-gray-500 mt-1">Chọn bài tập bên dưới để bắt đầu</p>
            </div>
            
            <!-- Body Modal (Danh sách Link) -->
            <div id="modalBody" class="p-6 max-h-[60vh] overflow-y-auto space-y-3 bg-white/80">
                <!-- Links sẽ được JS chèn vào đây -->
            </div>

            <!-- Footer Modal -->
            <div class="p-4 bg-gray-50 border-t border-gray-100 text-center">
                <button onclick="closeModalDirect()" class="px-6 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-200 transition-colors">Đóng</button>
            </div>
        </div>
    </div>

    <!-- PHẦN ĐĂNG NHẬP (Mặc định ẩn, chờ JS quyết định) -->
    <div id="loginSection" class="hidden min-h-screen flex flex-col justify-center items-center px-4 relative z-10">
        <div class="max-w-md w-full glass-card rounded-3xl p-10 fade-in-up">
            <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-2 shadow-inner">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
            </div>
            <h2 class="text-3xl font-bold text-center mb-2 text-blue-800">WELCOME BACK</h2>
            <p class="text-center mb-8 text-gray-500 text-sm">Vui lòng nhập mã truy cập để vào hệ thống</p>
            
            <div class="space-y-6">
                <div>
                    <input type="password" id="code" placeholder="Nhập mã truy cập..." class="w-full px-5 py-4 rounded-xl input-modern outline-none text-lg text-center tracking-widest" onkeypress="handleKeyPress(event)">
                </div>
                <!-- Sửa onclick gọi hàm mới -->
                <button id="loginBtn" class="w-full py-4 px-4 rounded-xl font-bold text-white transition-all duration-300 btn-modern tracking-wide" onclick="handleManualLogin()">ĐĂNG NHẬP</button>
                <div id="message" class="text-center font-medium text-sm mt-4 hidden bg-white/50 py-2 rounded-lg"></div>
            </div>
        </div>
    </div>

    <!-- NỘI DUNG CHÍNH (Mặc định ẩn) -->
    <div id="mainContent" class="hidden relative z-10 min-h-screen flex flex-col">
        <header class="py-12 fade-in-up">
            <div class="max-w-5xl mx-auto px-4 text-center">
                <div class="inline-block px-4 py-1.5 rounded-full bg-blue-50 border border-blue-100 text-blue-700 text-xs font-bold tracking-wider mb-4 shadow-sm">HAN AI LAB EDUCATION</div>
                <h1 class="text-3xl sm:text-5xl font-extrabold tracking-tight leading-tight mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-blue-500">CỔNG THÔNG TIN TÀI NGUYÊN<br>TRỰC TUYẾN</h1>
                
                <button onclick="logout()" class="mt-4 px-6 py-2 rounded-full font-semibold text-gray-500 bg-white/50 hover:bg-white transition-all text-xs border border-gray-200">Đăng xuất</button>
            </div>
        </header>

        <!-- THANH ĐIỀU HƯỚNG NHANH -->
        <nav class="sticky-nav mb-10 fade-in-up" style="animation-delay: 0.1s;">
            <a href="#section-so-dau-bai" class="nav-item">Sổ đầu bài</a>
            <a href="#section-kiem-tra" class="nav-item">Kiểm tra</a>
            <a href="#section-btvn" class="nav-item">BTVN (HSK)</a>
            <a href="#section-tuong-tac" class="nav-item">Tương tác</a>
            <a href="#section-nang-cao" class="nav-item">Nâng cao</a>
        </nav>

        <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 w-full pb-24">
            
            <!-- 1. SỔ ĐẦU BÀI & KIỂM TRA -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16 fade-in-up" style="animation-delay: 0.2s;">
                <div id="section-so-dau-bai">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>SỔ ĐẦU BÀI</h3>
                    <a href="https://khoa1508.github.io/portal/tiendohoctap" target="_blank" class="glass-card hover-card-effect p-6 rounded-2xl flex items-center justify-between group cursor-pointer block">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center mr-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                            </div>
                            <span class="font-bold text-gray-700">Theo dõi tiến độ</span>
                        </div>
                        <span class="text-gray-400 group-hover:translate-x-1 transition-transform">→</span>
                    </a>
                </div>
                <div id="section-kiem-tra">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center"><span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>KIỂM TRA</h3>
                    <a href="https://khoa1508.github.io/han1/bai1" target="_blank" class="glass-card hover-card-effect p-6 rounded-2xl flex items-center justify-between group cursor-pointer block">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center mr-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            </div>
                            <span class="font-bold text-gray-700">Đề kiểm tra</span>
                        </div>
                        <span class="text-gray-400 group-hover:translate-x-1 transition-transform">→</span>
                    </a>
                </div>
            </div>

            <hr class="border-gray-200/50 mb-12">

            <!-- 2. BÀI TẬP VỀ NHÀ (HSK 1-6) -->
            <section id="section-btvn" class="mb-16 fade-in-up" style="animation-delay: 0.3s;">
                <div class="flex items-center mb-6">
                    <div class="w-1.5 h-8 bg-green-500 rounded-full mr-4"></div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">BÀI TẬP VỀ NHÀ</h2>
                        <p class="text-sm text-gray-500">Luyện tập theo cấp độ HSK</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <!-- HSK 1 -->
                    <div onclick="openModal('btvn_hsk1')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-center text-center group h-40 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 hsk-1"></div>
                        <div class="w-10 h-10 rounded-full bg-green-50 text-hsk-1 flex items-center justify-center mb-2 font-bold text-lg">1</div>
                        <span class="font-bold text-gray-700 mb-1">HSK 1</span>
                        <span class="text-xs text-gray-400 group-hover:text-green-600">Sơ cấp 1</span>
                    </div>
                    <!-- HSK 2 -->
                    <div onclick="openModal('btvn_hsk2')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-center text-center group h-40 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 hsk-2"></div>
                        <div class="w-10 h-10 rounded-full bg-sky-50 text-hsk-2 flex items-center justify-center mb-2 font-bold text-lg">2</div>
                        <span class="font-bold text-gray-700 mb-1">HSK 2</span>
                        <span class="text-xs text-gray-400 group-hover:text-sky-600">Sơ cấp 2</span>
                    </div>
                    <!-- HSK 3 -->
                    <div onclick="openModal('btvn_hsk3')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-center text-center group h-40 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 hsk-3"></div>
                        <div class="w-10 h-10 rounded-full bg-violet-50 text-hsk-3 flex items-center justify-center mb-2 font-bold text-lg">3</div>
                        <span class="font-bold text-gray-700 mb-1">HSK 3</span>
                        <span class="text-xs text-gray-400 group-hover:text-violet-600">Trung cấp 1</span>
                    </div>
                    <!-- HSK 4 -->
                    <div onclick="openModal('btvn_hsk4')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-center text-center group h-40 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 hsk-4"></div>
                        <div class="w-10 h-10 rounded-full bg-rose-50 text-hsk-4 flex items-center justify-center mb-2 font-bold text-lg">4</div>
                        <span class="font-bold text-gray-700 mb-1">HSK 4</span>
                        <span class="text-xs text-gray-400 group-hover:text-rose-600">Trung cấp 2</span>
                    </div>
                    <!-- HSK 5 -->
                    <div onclick="openModal('btvn_hsk5')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-center text-center group h-40 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 hsk-5"></div>
                        <div class="w-10 h-10 rounded-full bg-amber-50 text-hsk-5 flex items-center justify-center mb-2 font-bold text-lg">5</div>
                        <span class="font-bold text-gray-700 mb-1">HSK 5</span>
                        <span class="text-xs text-gray-400 group-hover:text-amber-600">Cao cấp 1</span>
                    </div>
                    <!-- HSK 6 -->
                    <div onclick="openModal('btvn_hsk6')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-center text-center group h-40 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 hsk-6"></div>
                        <div class="w-10 h-10 rounded-full bg-red-50 text-hsk-6 flex items-center justify-center mb-2 font-bold text-lg">6</div>
                        <span class="font-bold text-gray-700 mb-1">HSK 6</span>
                        <span class="text-xs text-gray-400 group-hover:text-red-800">Cao cấp 2</span>
                    </div>
                </div>
            </section>

            <!-- 3. BÀI TẬP TƯƠNG TÁC -->
            <section id="section-tuong-tac" class="mb-16 fade-in-up" style="animation-delay: 0.4s;">
                <div class="flex items-center mb-6">
                    <div class="w-1.5 h-8 bg-purple-600 rounded-full mr-4"></div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">TƯƠNG TÁC TRÊN LỚP</h2>
                        <p class="text-sm text-gray-500">Hoạt động nhóm và cá nhân</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- NHÓM -->
                    <div onclick="openModal('tuongtac_nhom')" class="glass-card hover-card-effect p-6 rounded-2xl flex flex-row items-center relative overflow-hidden group">
                        <div class="absolute right-0 top-0 w-32 h-32 bg-purple-200 rounded-full opacity-20 -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 text-white flex items-center justify-center shadow-lg mr-6 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 mb-1">Tương tác Nhóm</h3>
                            <p class="text-sm text-gray-500">Hoạt động thảo luận và bài tập team</p>
                        </div>
                    </div>

                    <!-- 1-1 -->
                    <div onclick="openModal('tuongtac_11')" class="glass-card hover-card-effect p-6 rounded-2xl flex flex-row items-center relative overflow-hidden group">
                        <div class="absolute right-0 top-0 w-32 h-32 bg-pink-200 rounded-full opacity-20 -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-pink-500 to-rose-500 text-white flex items-center justify-center shadow-lg mr-6 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 mb-1">Tương tác 1-1</h3>
                            <p class="text-sm text-gray-500">Luyện tập cá nhân cùng giáo viên</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. BÀI TẬP NÂNG CAO -->
            <section id="section-nang-cao" class="mb-12 fade-in-up" style="animation-delay: 0.5s;">
                <div class="flex items-center mb-6">
                    <div class="w-1.5 h-8 bg-gray-700 rounded-full mr-4"></div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">BÀI TẬP NÂNG CAO</h2>
                        <p class="text-sm text-gray-500">Thử thách chuyên sâu (Advanced)</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <div onclick="openModal('nangcao_hsk1')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-between h-48 group border-t-4 border-emerald-500 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded">PRO</span>
                        <div class="mt-4 text-3xl font-black text-gray-200 group-hover:text-emerald-500 transition-colors">1</div>
                        <div class="text-center mb-4">
                            <span class="block font-bold text-gray-800 text-sm">HSK 1</span>
                            <span class="text-xs text-gray-400">Nâng cao</span>
                        </div>
                    </div>

                    <div onclick="openModal('nangcao_hsk2')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-between h-48 group border-t-4 border-sky-500 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded">PRO</span>
                        <div class="mt-4 text-3xl font-black text-gray-200 group-hover:text-sky-500 transition-colors">2</div>
                        <div class="text-center mb-4">
                            <span class="block font-bold text-gray-800 text-sm">HSK 2</span>
                            <span class="text-xs text-gray-400">Nâng cao</span>
                        </div>
                    </div>

                    <div onclick="openModal('nangcao_hsk3')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-between h-48 group border-t-4 border-violet-500 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded">PRO</span>
                        <div class="mt-4 text-3xl font-black text-gray-200 group-hover:text-violet-500 transition-colors">3</div>
                        <div class="text-center mb-4">
                            <span class="block font-bold text-gray-800 text-sm">HSK 3</span>
                            <span class="text-xs text-gray-400">Nâng cao</span>
                        </div>
                    </div>

                    <div onclick="openModal('nangcao_hsk4')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-between h-48 group border-t-4 border-rose-500 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded">PRO</span>
                        <div class="mt-4 text-3xl font-black text-gray-200 group-hover:text-rose-500 transition-colors">4</div>
                        <div class="text-center mb-4">
                            <span class="block font-bold text-gray-800 text-sm">HSK 4</span>
                            <span class="text-xs text-gray-400">Nâng cao</span>
                        </div>
                    </div>

                    <div onclick="openModal('nangcao_hsk5')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-between h-48 group border-t-4 border-amber-500 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded">PRO</span>
                        <div class="mt-4 text-3xl font-black text-gray-200 group-hover:text-amber-500 transition-colors">5</div>
                        <div class="text-center mb-4">
                            <span class="block font-bold text-gray-800 text-sm">HSK 5</span>
                            <span class="text-xs text-gray-400">Nâng cao</span>
                        </div>
                    </div>

                    <div onclick="openModal('nangcao_hsk6')" class="glass-card hover-card-effect p-4 rounded-xl flex flex-col items-center justify-between h-48 group border-t-4 border-red-700 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded">PRO</span>
                        <div class="mt-4 text-3xl font-black text-gray-200 group-hover:text-red-700 transition-colors">6</div>
                        <div class="text-center mb-4">
                            <span class="block font-bold text-gray-800 text-sm">HSK 6</span>
                            <span class="text-xs text-gray-400">Nâng cao</span>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- SCRIPT (LOGIC & DỮ LIỆU) -->
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw0UuBeAYAEUcmx81DU6S1MxpJBm_VOutbkBvTGzl__bV2FvEPAtllTcBpn0gizsWEa/exec";

        // --- CẤU HÌNH DỮ LIỆU BÀI TẬP (GIỮ NGUYÊN NHƯ CŨ) ---
        const resourceData = {
            // == BTVN HSK ==
            "btvn_hsk1": {
                title: "Bài tập về nhà - HSK 1",
                subtitle: "Các bài luyện tập cơ bản cho HSK 1",
                links: [
                    { name: "Bài 1: Xin chào (你好)", url: "https://example.com/hsk1/bai1" },
                    { name: "Bài 2: Cảm ơn (谢谢)", url: "https://example.com/hsk1/bai2" },
                    { name: "Bài 3: Tên bạn là gì?", url: "https://example.com/hsk1/bai3" },
                ]
            },
            "btvn_hsk2": {
                title: "Bài tập về nhà - HSK 2",
                subtitle: "Luyện tập sơ cấp 2",
                links: [
                    { name: "Bài 1: Ngày tháng năm", url: "https://example.com/hsk2/bai1" },
                    { name: "Bài 2: Gia đình", url: "https://example.com/hsk2/bai2" },
                ]
            },
            "btvn_hsk3": {
                title: "Bài tập về nhà - HSK 3",
                subtitle: "Luyện tập trung cấp 1",
                links: [
                    { name: "Bài 1: Cuối tuần", url: "#" },
                    { name: "Bài 2: Sở thích", url: "#" },
                ]
            },
            "btvn_hsk4": {
                title: "Bài tập về nhà - HSK 4",
                subtitle: "Luyện tập trung cấp 2",
                links: [
                    { name: "Bài 1: Công việc", url: "#" },
                    { name: "Bài 2: Du lịch", url: "#" },
                ]
            },
            "btvn_hsk5": {
                title: "Bài tập về nhà - HSK 5",
                subtitle: "Luyện tập cao cấp 1",
                links: [
                    { name: "Bài 1: Kinh tế", url: "#" },
                ]
            },
            "btvn_hsk6": {
                title: "Bài tập về nhà - HSK 6",
                subtitle: "Luyện tập cao cấp 2",
                links: [
                    { name: "Bài 1: Văn hóa", url: "#" },
                ]
            },

            // == TƯƠNG TÁC ==
            "tuongtac_nhom": {
                title: "Tương tác Nhóm",
                subtitle: "Các bài tập thảo luận nhóm",
                links: [
                    { name: "Thảo luận Chủ đề 1: Mua sắm", url: "https://example.com/group/topic1" },
                    { name: "Dự án nhóm: Thuyết trình văn hóa", url: "https://example.com/group/project1" },
                ]
            },
            "tuongtac_11": {
                title: "Tương tác 1-1",
                subtitle: "Luyện tập cá nhân cùng giáo viên",
                links: [
                    { name: "Luyện khẩu ngữ: Bài 1", url: "https://example.com/1on1/bai1" },
                    { name: "Sửa bài viết: Bài 2", url: "https://example.com/1on1/bai2" },
                ]
            },

            // == NÂNG CAO ==
            "nangcao_hsk1": {
                title: "Nâng cao - HSK 1 Pro",
                subtitle: "Thử thách khó cho trình độ 1",
                links: [
                    { name: "Thử thách nghe hiểu nhanh", url: "#" },
                    { name: "Dịch câu phức", url: "#" },
                ]
            },
            "nangcao_hsk2": {
                title: "Nâng cao - HSK 2 Pro",
                subtitle: "Thử thách khó cho trình độ 2",
                links: [
                    { name: "Bài đọc hiểu mở rộng", url: "#" },
                ]
            },
             "nangcao_hsk3": {
                title: "Nâng cao - HSK 3 Pro",
                subtitle: "Thử thách khó cho trình độ 3",
                links: [{ name: "Bài tập tổng hợp", url: "#" }]
            },
             "nangcao_hsk4": {
                title: "Nâng cao - HSK 4 Pro",
                subtitle: "Thử thách khó cho trình độ 4",
                links: [{ name: "Bài tập tổng hợp", url: "#" }]
            },
             "nangcao_hsk5": {
                title: "Nâng cao - HSK 5 Pro",
                subtitle: "Thử thách khó cho trình độ 5",
                links: [{ name: "Bài tập tổng hợp", url: "#" }]
            },
             "nangcao_hsk6": {
                title: "Nâng cao - HSK 6 Pro",
                subtitle: "Thử thách khó cho trình độ 6",
                links: [{ name: "Bài tập tổng hợp", url: "#" }]
            }
        };

        // --- HÀM XỬ LÝ MODAL (GIỮ NGUYÊN) ---
        function openModal(key) {
            const data = resourceData[key];
            if (!data) return;

            // 1. Điền thông tin
            document.getElementById('modalTitle').textContent = data.title;
            document.getElementById('modalSubtitle').textContent = data.subtitle || "Danh sách bài tập";

            // 2. Tạo danh sách link
            const body = document.getElementById('modalBody');
            body.innerHTML = ''; // Xóa cũ

            if (data.links && data.links.length > 0) {
                data.links.forEach(link => {
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.target = "_blank";
                    a.className = "flex items-center justify-between p-4 rounded-xl border border-gray-100 bg-gray-50 hover:bg-white hover:border-blue-200 hover:shadow-md transition-all group";
                    a.innerHTML = `
                        <span class="font-medium text-gray-700 group-hover:text-blue-700">${link.name}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    `;
                    body.appendChild(a);
                });
            } else {
                body.innerHTML = '<p class="text-center text-gray-400 italic py-4">Chưa có bài tập nào được cập nhật.</p>';
            }

            // 3. Hiển thị Modal
            const modal = document.getElementById('linkModal');
            modal.classList.remove('hidden');
        }

        function closeModal(event) {
            if (event.target.id === 'linkModal') {
                document.getElementById('linkModal').classList.add('hidden');
            }
        }
        
        function closeModalDirect() {
            document.getElementById('linkModal').classList.add('hidden');
        }

        // --- LOGIC BẢO MẬT MỚI (STRICT SECURITY) ---
        
        // 1. Khi tải trang: Kiểm tra ngay lập tức
        document.addEventListener('DOMContentLoaded', function() {
            const storedCode = localStorage.getItem('ddkTeacherCode'); // Lấy mã đã lưu
            
            if (storedCode) {
                // Nếu có mã, gọi hàm kiểm tra bảo mật (background check)
                verifySession(storedCode);
            } else {
                // Nếu không có mã, tắt loading, hiện màn hình đăng nhập
                hideLoader();
                showLoginScreen();
            }
        });

        // Hàm xác thực mỗi lần tải trang
        async function verifySession(code) {
            try {
                // Gửi request lên Google Sheets
                const response = await fetch(`${SCRIPT_URL}?code=${encodeURIComponent(code)}`, {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                // Vì Google trả về 302, cần xử lý cẩn thận hoặc dùng text() rồi parse
                const textResult = await response.text();
                let data;
                try { data = JSON.parse(textResult); } catch (e) { throw new Error("Lỗi dữ liệu server"); }

                if (data.valid === true) {
                    // CÒN HẠN: Cho vào
                    hideLoader();
                    showMainContent();
                } else {
                    // HẾT HẠN/ĐỔI PASS: Đá ra
                    alert("Phiên đăng nhập đã hết hạn hoặc mã truy cập đã bị thay đổi. Vui lòng đăng nhập lại.");
                    logout();
                }
            } catch (error) {
                console.error("Lỗi xác thực:", error);
                // Nếu mất mạng hoặc lỗi server, để an toàn -> Đá ra (hoặc có thể cho vào tạm tùy bạn, ở đây tôi chọn đá ra để bảo mật cao nhất)
                alert("Không thể xác thực bảo mật. Vui lòng kiểm tra kết nối internet.");
                logout();
            }
        }

        function handleKeyPress(event) { if (event.key === 'Enter') handleManualLogin(); }

        // Hàm xử lý khi bấm nút Đăng nhập
        async function handleManualLogin() {
            const inputEl = document.getElementById('code');
            const code = inputEl.value.trim(); 
            const message = document.getElementById('message');
            const loginBtn = document.getElementById('loginBtn');
            
            if (!code) { showMessage('Vui lòng nhập mã truy cập!', 'error'); return; }

            loginBtn.innerHTML = 'ĐANG KIỂM TRA...'; loginBtn.disabled = true; message.classList.add('hidden'); 

            try {
                const response = await fetch(`${SCRIPT_URL}?code=${encodeURIComponent(code)}`, { method: 'GET', redirect: 'follow' });
                const textResult = await response.text();
                let data; try { data = JSON.parse(textResult); } catch (e) { throw new Error("Lỗi kết nối."); }
                
                if (data.valid === true) {
                    showMessage(data.message || 'Thành công!', 'success');
                    
                    // LƯU QUAN TRỌNG: Lưu mã code chứ không lưu boolean
                    localStorage.setItem('ddkTeacherCode', code);
                    
                    setTimeout(() => {
                        showMainContent();
                        // Ẩn login screen đi
                        document.getElementById('loginSection').classList.add('hidden');
                    }, 1000);
                } else {
                    showMessage(data.message || 'Sai mã!', 'error');
                }
            } catch (error) {
                showMessage('Lỗi kết nối server', 'error');
            } finally {
                loginBtn.innerHTML = 'ĐĂNG NHẬP'; loginBtn.disabled = false;
            }
        }

        function showMessage(text, type) {
            const message = document.getElementById('message'); message.textContent = text; message.classList.remove('hidden');
            message.className = type === 'success' ? "text-center font-medium text-sm mt-4 bg-green-50 text-green-700 py-2 rounded-lg border border-green-200" : "text-center font-medium text-sm mt-4 bg-red-50 text-red-700 py-2 rounded-lg border border-red-200";
        }

        function showMainContent() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            // Cập nhật link để bypass referrer check ở các web con
            document.querySelectorAll('a').forEach(link => { link.removeAttribute('rel'); link.setAttribute('rel', 'opener'); });
        }

        function showLoginScreen() {
            document.getElementById('loadingOverlay').style.display = 'none'; // Đảm bảo tắt loading
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }

        function hideLoader() {
            const loader = document.getElementById('loadingOverlay');
            loader.style.opacity = '0';
            setTimeout(() => { loader.style.display = 'none'; }, 500);
        }

        function logout() {
            localStorage.removeItem('ddkTeacherCode'); // Xóa mã gốc
            location.reload(); // Tải lại trang để hiện login
        }
    </script>
</body>
</html>
